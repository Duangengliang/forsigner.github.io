<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta charset="utf-8">
  
  <title>理解JavaScript闭包 | forsigner</title>
  <meta name="author" content="forisnger">
  
  <meta name="description" content="前端&amp;设计">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="理解JavaScript闭包"/>
  <meta property="og:site_name" content="forsigner"/>

  
    <meta property="og:image" content="undefined"/>
  

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="alternate" href="/atom.xml" title="forsigner" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="/js/modernizr.js"></script>
  <script src="/js/jquery-1.9.0.min.js"></script>
  <script src="/js/forsigner.js"></script>

<link rel="stylesheet/less" type="text/css" href="/less/style.less" />


  <script src="/js/less-1.3.3.min.js"></script>


</head>


<body>
    <section class="left">
        <div class="sidebar">
            <header id="header" class="header"><div class="blog-info">
    <div class="wrap-logo">
        <a href="/">
            <div class="blog-logo dib">
                <div class="circle"></div>
                <div class="line"></div>
            </div>
            <div class="blog-name dib">forsigner</div>
        </a>
    </div>
    <!--
    <aside class="blog-desc">前端&amp;设计</aside>
    -->
</div>
</header>
            <aside><nav id="nav" class="nav">
    <ul>
        
    </ul>
</nav>

  
<div class="widget tag">
  <ul>
  
    <li><a href="/tags/CSS/">CSS</a></li>
  
    <li><a href="/tags/JavaSctipt/">JavaSctipt</a></li>
  
    <li><a href="/tags/前端工具/">前端工具</a></li>
  
    <li><a href="/tags/设计/">设计</a></li>
  
    <li><a href="/tags/读书/">读书</a></li>
  
    <li><a href="/tags/随记/">随记</a></li>
  
  </ul>
</div>



</aside>
            <a class="about" href="/about/">i</a>
        </div>
    </section>
    <section class="right">
        <div id="content" class="content">
            <div class="wrap-post"><article class="post">
  
  <div class="post-content">
    <header>
      
  
    <h1 class="post-title">理解JavaScript闭包</h1>
  


      
        <time class="post-time" datetime="2013-02-13T12:57:29.000Z">2月13 2013</time>
      
    </header>
    <div class="entry">
      
        <p>从开始学习JavaScript时，就听说闭包是个强大的东西，但也是一个很复杂很难懂的东西。一直以来也对闭包似懂非懂，</p>
<p>直到最近在读汤姆大叔的深入理解JavaScript系列 才基本弄懂什么是闭包，这里感学大叔无私的分享，这种无私的分享精神非常值得学习。下面关于我对闭包的描述大多数也是从大叔那看来。</p>
<p>闭包的定义</p>
<p>从理论角度：所有的函数。因为它们都在创建的时候就将上层上下文的数据保存起来了。哪怕是简单的全局变量也是如此，因为函数中访问全局变量就相当于是在访问自由变量，这个时候使用最外层的作用域。</p>
<p>从实践角度：以下函数才算是闭包：
             1.即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）
             2.在代码中引用了自由变量
上面是汤姆大叔对闭包的定义，本来我想用自己的话来定义一下，但发现这是我见过对闭包最完美的定义，自己实在想不出有比这更准确、更通俗易懂的定义了，所以也不去写自己对闭包的定义了。
<a name="more"></a>
闭包的例子</p>
<p>下面是一些闭包使用的例子，当然这里的闭包是从实践的角度来讲的。</p>
<p>例子一（最简单的闭包）：</p>
<p><figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">var</span> a = <span class="string">"hello"</span>; <span class="comment">//函数外部的自由变量a</span>
<span class="comment">//这个函数就是一个闭包</span>
<span class="function"><span class="keyword">function</span> <span class="title">simplestClosure</span><span class="params">()</span> {</span>
    alert(a);
}
simplestClosure(); <span class="comment">//将alert出hello</span>
</pre></td></tr></table></figure>
函数simplestClosure在自己的[[scope]]寻找不到变量a，(我就把[[scope]]称作函数的作用域吧，虽然不太正确，但好理解)，它就会通过作用域链在它的父级函数的作用域或全局内寻找变量a，通过这种链式查找，函数可以访问到自由变量a，这就形成了最简单的闭包。</p>
<p>例子二（内部函数从父函数中返回）：</p>
<p><figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">var</span> x = <span class="number">1</span>;
<span class="function"><span class="keyword">function</span> <span class="title">outerClosure</span><span class="params">()</span>  {</span>
    <span class="keyword">var</span> y = <span class="number">2</span>;
    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">closure</span><span class="params">(z)</span> {</span>
        alert(x+y+z);
    }
}
<span class="comment">//调用闭包函数closure，将alert出6</span>
</pre></td></tr></table></figure>
例子三（使用匿名函数隐藏全局作用域变量）：</p>
<p><figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="comment">// 创建一个匿名函数作为包装</span>
(<span class="keyword">function</span>() {
    <span class="comment">//变量原本应该是全局的</span>
    <span class="keyword">var</span> msg = <span class="string">"hello"</span>;
    <span class="comment">//将一个新函数绑定到全局对象</span>
    window.onload = <span class="keyword">function</span>()  {
    <span class="comment">// 这个函数使用“隐藏”变量msg</span>
       alert(msg);
    }
})();
</pre></td></tr></table></figure>
例子四（创建封装的作用域来隐藏辅助对象）：</p>
<p><figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="keyword">var</span> foo = {};
<span class="comment">// 初始化</span>
(<span class="function"><span class="keyword">function</span> <span class="params">(object)</span> {</span>
    <span class="keyword">var</span> x = <span class="number">10</span>;
    object.getX = <span class="function"><span class="keyword">function</span> <span class="title">_getX</span><span class="params">()</span> {</span>
        <span class="keyword">return</span> x;
    };
})(foo);
alert(foo.getX()); <span class="comment">// 获得闭包 "x" – 10</span>
</pre></td></tr></table></figure>
例子五（延时调用）：</p>
<p><figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="keyword">var</span> a = <span class="number">10</span>;
setTimeout(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    alert(a); <span class="comment">// 10, after one second </span>
},  <span class="number">1000</span>);
</pre></td></tr></table></figure>
例子六(回调函数)：</p>
<p><figure class="highlight lang-javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">var</span> x = <span class="number">10</span>;
<span class="comment">// only for example</span>
xmlHttpRequestObject.onreadystatechange = <span class="keyword">function</span>() {
    <span class="comment">// 当数据就绪的时候，才会调用;</span>
    <span class="comment">// 这里，不论是在哪个上下文中创建</span>
    <span class="comment">// 此时变量“x”的值已经存在了</span>
    alert(x); <span class="comment">// 10</span>
};
</pre></td></tr></table></figure>
这里没深入讨论闭包的理论，有兴趣的同学建议去看看大叔的博客和他的的深入理解JavaScript系列。done。</p>

      
    </div>
    <footer>
      
      
    </footer>
  </div>
</article>


<section id="comment">
<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
    <script type="text/javascript">
        var duoshuoQuery = {short_name:"yieelinn"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'http://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
            || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
<!-- Duoshuo Comment END -->
</section>


</div>
        </div>
        <div id="back-to-top" class="back-to-top"></div>
        <footer id="footer" class="footer">
    
    &copy; 2013 forisnger
    
</footer>

        
    </section>
</body>
</html>
